---
title: "Lab 5"
author: "Woocheol Kim"
date: "October 21, 2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE) 
```

1. Read in the following three datasets, using {here} and {rio}:
  * *sesame13.sav*
  * *star.csv*
  * *ais.xlsx*
  
*Hint*: For the *ais.xlsx* dataset look at the `skip` argument within the `rio` help 
  documentation.
  
```{r import}
library(rio)
library(here)
here("data")
sesame13 <- import(here("data", "sesame13.sav"))
star <- import(here("data", "star.csv"))
ais <- import(here("data", "ais.xlsx"), skip =15)
 



```

2. Using the ais data, compute the average red blood cell count and average bmi by sport. Output these data as SPSS and EXCEL files. 

```{r q2}
library(tidyverse)
ais %>%
  group_by(sport) %>%
  summarize(mean_rcc = mean(rcc), mean_bmi = mean(bmi))

ais_rccbmi <- ais %>%
  group_by(sport) %>%
  summarize(mean_rcc = mean(rcc), mean_bmi = mean(bmi))

export(ais_rccbmi, here("data", "ais_rccbmi.sav"))
export(ais_rccbmi, here("data", "ais_rccbmi.xlsx"))
```

3. Use the sesame dataset to answer the following question: Was the average 
  female age higher in schools or at home? 

```{r q3}

sesame13 %>%
  characterize() %>%
  select(site, sex, age, viewing:treatmen) %>%
  group_by(setting) %>%
  filter(sex == "Female") %>%
  summarize(mean_age = mean(age)) %>%
    ggplot(aes(setting, mean_age)) +
    geom_col(fill = "cornflowerblue", alpha = 0.4) +
    labs(y = "average female age")


```

Average female age is higher in schools than at home. 

4. First, how many rows and columns are in the *star* dataset? Next, remove outliers using a really poor method, just for practice, by eliminating students whose math (*tmathss*) scores were more than three standard deviations **above or below** the corresponding mean. How many rows are in the dataset now?

```{r q4}
star <- import(here("data", "star.csv"))
dim(star)
star_eli_outliers <- star %>%
  mutate(math_mean = mean(tmathss), math_sdv = sd(tmathss)) %>%
  filter(tmathss >= math_mean - 3*math_sdv & tmathss <= math_mean + 3*math_sdv)
dim(star_eli_outliers)
  
```

There are 5748 rows and 12 columns in the star. After removing outliers, there are 5743 rows in the dataset. 

5. Use the star dataset to compute standardized math and reading scores (*tmathss* and *treadss*); i.e., for each of those variables, subtract the mean from each observation and divide by the standard deviation: $x_s = \frac{x_i - \bar{X}}{sd(X)}$. 
  + Check that your computations were correct by computing the mean and standard deviation of each variable (they should be 0 and 1). 
  + Compute the mean of the standardized variable for all *sex*/*frl* combinations (I'm asking you to extend what you know, we haven't talked explicitly about how to do this yet). 
  + What do you make of these findings? Do you see an effect by sex? An FRL effect? Is there evidence of an interaction (i.e., that the effect of FRL is greater for boys versus girls)?

```{r q5}
star <- import(here("data", "star.csv"))
star_standardized <- star %>%
  mutate(math_mean = mean(tmathss), math_sdv = sd(tmathss), read_mean = mean(treadss), read_sdv = sd(treadss)) %>%
  mutate(st_math = (tmathss - math_mean) / math_sdv, st_read = (treadss - read_mean) / read_sdv)

star_standardized %>%
  summarize(mean_st_math = mean(st_math), sd_st_math = sd(st_math), mean_st_read = mean(st_read), sd_st_read = sd(st_read))

star_standardized %>%
  group_by(sex, frl) %>%
  summarize(mean_st_math = mean(st_math), sd_st_math = sd(st_math), mean_st_read = mean(st_read), sd_st_read = sd(st_read))
```
With this results, we are able to study the effect of sex and socioeconomic status on academic achievement. With respect to sex, girls outperform boys in both math and reading holding FRL constant. Also, students without FRL, in other words, from mid-upper class do better than students with FRL regardless of sex. Although the effect of FRL is slightly larger for girls in both math and reading, it is somewhat insignificant. In fact, the score differences between no FRL and FRL for girls are similar to the one for boys.  